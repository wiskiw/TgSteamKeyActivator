{"version":3,"sources":["../../../src/service/main/config-validation.js"],"names":["type","func","typeof","num","str","bool","obj","app","properties","publicKeys","uniqueItems","storage","required","get","set","remove","clear","additionalProperties","plugins","api","invokeWithLayer","layer","initConnection","api_id","device_model","system_version","app_version","lang_code","dc","id","host","port","server","dev","webogram","dcList","items","schema","mtSchema","ajv","validate","compile","configValidator","config","valid","console","log","errors","map","printObj","Error","arg"],"mappings":";;;;;;AAEA;;;;AACA;;;;;;AAEA,IAAMA,OAAO;AACXC,QAAM,EAAEC,QAAQ,UAAV,EADK;AAEXC,OAAM,EAAEH,MAAM,QAAR,EAFK;AAGXI,OAAM,EAAEJ,MAAM,QAAR,EAHK;AAIXK,QAAM,EAAEL,MAAM,SAAR,EAJK;AAKXM,OAAM,EAAEN,MAAM,QAAR;AALK,CAAb;;AAQA,IAAMO,MAAM;AACVP,QAAY,QADF;AAEVQ,cAAY;AACVC,gBAAY;AACVT,YAAa,OADH;AAEVU,mBAAa;AAFH,KADF;AAKVC,aAAS;AACPX,YAAY,QADL;AAEPY,gBAAY,CAAC,KAAD,EAAQ,KAAR,EAAe,QAAf,EAAyB,OAAzB,CAFL;AAGPJ,kBAAY;AACVK,aAAQb,KAAKC,IADH;AAEVa,aAAQd,KAAKC,IAFH;AAGVc,gBAAQf,KAAKC,IAHH;AAIVe,eAAQhB,KAAKC;AAJH,OAHL;AASPgB,4BAAsB;AATf,KALC;AAgBVC,aAAS;AACPlB,YAAa,OADN;AAEPU,mBAAa;AAFN;AAhBC,GAFF;AAuBVO,wBAAsB;AAvBZ,CAAZ;;AA0BA,IAAME,MAAM;AACVnB,QAAY,QADF;AAEVY,YAAY,CAAC,OAAD,EAAU,QAAV,CAFF;AAGVJ,cAAY;AACVY,qBAAiBpB,KAAKG,GADZ;AAEVkB,WAAiBrB,KAAKG,GAFZ;AAGVmB,oBAAiBtB,KAAKG,GAHZ;AAIVoB,YAAiBvB,KAAKG,GAJZ;AAKVqB,kBAAiBxB,KAAKI,GALZ;AAMVqB,oBAAiBzB,KAAKI,GANZ;AAOVsB,iBAAiB1B,KAAKI,GAPZ;AAQVuB,eAAiB3B,KAAKI;AARZ,GAHF;AAaVa,wBAAsB;AAbZ,CAAZ;;AAgBA,IAAMW,KAAK;AACT5B,QAAY,QADH;AAETY,YAAY,CAAC,IAAD,EAAO,MAAP,CAFH;AAGTJ,cAAY;AACVqB,QAAM7B,KAAKG,GADD;AAEV2B,UAAM9B,KAAKI,GAFD;AAGV2B,UAAM/B,KAAKG;AAHD,GAHH;AAQTc,wBAAsB;AARb,CAAX;;AAWA,IAAMe,SAAS;AACbhC,QAAY,QADC;AAEbQ,cAAY;AACVyB,SAAUjC,KAAKK,IADL;AAEV6B,cAAUlC,KAAKK,IAFL;AAGV8B,YAAU;AACRnC,YAAa,OADL;AAERU,mBAAa,IAFL;AAGR0B,aAAaR;AAHL;AAHA,GAFC;AAWbX,wBAAsB;AAXT,CAAf;;AAcA,IAAMoB,SAAS;AACb7B,cAAY;AACVD,OADU;AAEVY,OAFU;AAGVa,UAHU;AAIVK,YAAUrC,KAAKM,GAJL;AAKVgC,cAAUtC,KAAKM;AALL,GADC;AAQbW,wBAAsB;AART,CAAf;;AAWA,IAAMsB,MAAM,mBAAZ;AACA,sBAAQA,GAAR;AACA,IAAMC,WAAWD,IAAIE,OAAJ,CAAYJ,MAAZ,CAAjB;;AAEA,IAAMK,kBAAmBC,MAAD,IAAe;AACrC,MAAMC,QAAQJ,SAASG,MAAT,CAAd;AACA,MAAI,CAACC,KAAL,EAAY;AACVC,YAAQC,GAAR,CAAY,eAAZ;AACAN,aAASO,MAAT,CAAgBC,GAAhB,CAAoBC,QAApB;AACA,UAAM,IAAIC,KAAJ,CAAU,qBAAV,CAAN;AACD;AACF,CAPD;;AASA;AACA,IAAMD,WAAYE,GAAD,IAASN,QAAQC,GAAR,CAAYK,GAAZ,CAA1B;;kBAGeT,e","file":"config-validation.js","sourcesContent":["//@flow\n\nimport Ajv from 'ajv'\nimport AjvKeys from 'ajv-keywords/keywords/typeof'\n\nconst type = {\n  func: { typeof: 'function' },\n  num : { type: 'number' },\n  str : { type: 'string' },\n  bool: { type: 'boolean' },\n  obj : { type: 'object' }\n}\n\nconst app = {\n  type      : 'object',\n  properties: {\n    publicKeys: {\n      type       : 'array',\n      uniqueItems: true,\n    },\n    storage: {\n      type      : 'object',\n      required  : ['get', 'set', 'remove', 'clear'],\n      properties: {\n        get   : type.func,\n        set   : type.func,\n        remove: type.func,\n        clear : type.func\n      },\n      additionalProperties: true\n    },\n    plugins: {\n      type       : 'array',\n      uniqueItems: true,\n    },\n  },\n  additionalProperties: false\n}\n\nconst api = {\n  type      : 'object',\n  required  : ['layer', 'api_id'],\n  properties: {\n    invokeWithLayer: type.num,\n    layer          : type.num,\n    initConnection : type.num,\n    api_id         : type.num,\n    device_model   : type.str,\n    system_version : type.str,\n    app_version    : type.str,\n    lang_code      : type.str\n  },\n  additionalProperties: false\n}\n\nconst dc = {\n  type      : 'object',\n  required  : ['id', 'host'],\n  properties: {\n    id  : type.num,\n    host: type.str,\n    port: type.num\n  },\n  additionalProperties: false\n}\n\nconst server = {\n  type      : 'object',\n  properties: {\n    dev     : type.bool,\n    webogram: type.bool,\n    dcList  : {\n      type       : 'array',\n      uniqueItems: true,\n      items      : dc\n    }\n  },\n  additionalProperties: false\n}\n\nconst schema = {\n  properties: {\n    app,\n    api,\n    server,\n    schema  : type.obj,\n    mtSchema: type.obj\n  },\n  additionalProperties: false\n}\n\nconst ajv = new Ajv()\nAjvKeys(ajv)\nconst validate = ajv.compile(schema)\n\nconst configValidator = (config: *) => {\n  const valid = validate(config)\n  if (!valid) {\n    console.log('config errors')\n    validate.errors.map(printObj)\n    throw new Error('wrong config fields')\n  }\n}\n\n// const canDir = typeof console.dir === 'function'\nconst printObj = (arg) => console.log(arg)\n\n\nexport default configValidator\n"]}