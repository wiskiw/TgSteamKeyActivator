{"version":3,"sources":["../../src/dc-status/seq-no.js"],"names":["SeqNo","constructor","limit","init","count","first","current","holes","history","uniq","hasHoles","getNext","notContentRelated","seqNo","push","next","Math","max","length","dropCount","findMin","countHoles","ln","min","Infinity","i","val","range"],"mappings":";;;;;;AAEA;;AAEe,MAAMA,KAAN,CAAY;AAUzBC,gBAAc;AAAA,SATdC,KASc,GATE,GASF;;AACZ,SAAKC,IAAL;AACD;AACDA,SAAO;AACL,SAAKC,KAAL,GAAa,CAAb;AACA,SAAKC,KAAL,GAAa,CAAb;AACA,SAAKC,OAAL,GAAe,CAAf;AACA,SAAKC,KAAL,GAAa,CAAb;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,IAAL,GAAY,EAAZ;AACA,SAAKC,QAAL,GAAgB,KAAhB;AACD;AACDC,UAAQC,iBAAR,EAAqC;AACnC,QAAIC,QAAQ,KAAKT,KAAL,GAAa,CAAzB;AACA,QAAI,CAACQ,iBAAL,EAAwB;AACtBC;AACA,WAAKT,KAAL;AACD;AACD,SAAKU,IAAL,CAAUD,KAAV;AACA,WAAOA,KAAP;AACD;AACDC,OAAKC,IAAL,EAAmB;AACjB,SAAKT,OAAL,GAAeU,KAAKC,GAAL,CAAS,KAAKX,OAAd,EAAuBS,IAAvB,CAAf;AACA,SAAKP,OAAL,GAAe,mBAAOO,IAAP,EAAa,KAAKP,OAAlB,CAAf;AACA,QAAI,KAAKA,OAAL,CAAaU,MAAb,IAAuB,KAAKhB,KAAhC,EAAuC;AACrC,UAAMiB,YAAY,KAAKX,OAAL,CAAaU,MAAb,GAAsB,KAAKhB,KAA7C;AACA,WAAKM,OAAL,GAAe,iBAAKW,SAAL,EAAgB,KAAKX,OAArB,CAAf;AACD;AACD,SAAKC,IAAL,GAAY,iBAAK,KAAKD,OAAV,CAAZ;AACA,SAAKY,OAAL;AACA,SAAKC,UAAL;AACD;AACDD,YAAU;AACR,QAAME,KAAK,KAAKb,IAAL,CAAUS,MAArB;AACA,QAAIK,MAAMC,QAAV;AACA,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIH,EAApB,EAAwBG,GAAxB,EAA6B;AAC3B,UAAMC,MAAM,KAAKjB,IAAL,CAAUgB,CAAV,CAAZ;AACA,UAAIC,MAAMH,GAAV,EACEA,MAAMG,GAAN;AACH;AACD,SAAKrB,KAAL,GAAakB,GAAb;AACD;AACDF,eAAa;AACX,QAAMC,KAAK,KAAKb,IAAL,CAAUS,MAArB;AACA,QAAII,OAAO,CAAX,EAAc;AACZ,WAAKf,KAAL,GAAa,CAAb;AACA;AACD;AACD,QAAMoB,QAAQ,KAAKrB,OAAL,GAAe,KAAKD,KAAlC;AACA,SAAKE,KAAL,GAAaoB,QAAQL,EAArB;AACA,SAAKZ,QAAL,GAAgB,KAAKH,KAAL,KAAe,CAA/B;AACD;AA7DwB;kBAANP,K","file":"seq-no.js","sourcesContent":["//@flow\n\nimport { uniq, append, drop } from 'ramda'\n\nexport default class SeqNo {\n  limit: number = 100\n\n  count: number\n  first: number\n  current: number\n  holes: number\n  history: number[]\n  uniq: number[]\n  hasHoles: boolean\n  constructor() {\n    this.init()\n  }\n  init() {\n    this.count = 0\n    this.first = 0\n    this.current = 0\n    this.holes = 0\n    this.history = []\n    this.uniq = []\n    this.hasHoles = false\n  }\n  getNext(notContentRelated?: boolean) {\n    let seqNo = this.count * 2\n    if (!notContentRelated) {\n      seqNo++\n      this.count++\n    }\n    this.push(seqNo)\n    return seqNo\n  }\n  push(next: number) {\n    this.current = Math.max(this.current, next)\n    this.history = append(next, this.history)\n    if (this.history.length >= this.limit) {\n      const dropCount = this.history.length - this.limit\n      this.history = drop(dropCount, this.history)\n    }\n    this.uniq = uniq(this.history)\n    this.findMin()\n    this.countHoles()\n  }\n  findMin() {\n    const ln = this.uniq.length\n    let min = Infinity\n    for (let i = 0; i < ln; i++) {\n      const val = this.uniq[i]\n      if (val < min)\n        min = val\n    }\n    this.first = min\n  }\n  countHoles() {\n    const ln = this.uniq.length\n    if (ln === 0) {\n      this.holes = 0\n      return\n    }\n    const range = this.current - this.first\n    this.holes = range - ln\n    this.hasHoles = this.holes === 0\n  }\n}\n"]}