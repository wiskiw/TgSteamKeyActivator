{"version":3,"sources":["../../src/event/scoped-emitter.js"],"names":["arrify","normalizeScope","scope","reduceStarter","combineScope","scopes","reduce","acc","val","concat","ScopedEmitter","constructor","parent","on","event","listener","fullEvent","root","off","join","emit","values","addEventListener","removeEventListener","EventScope","of","list","Array","isArray","map","fn","value","e","ap","equals","entries","index","str","empty","joined","emitScope","es","em","data"],"mappings":"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","file":"scoped-emitter.js","sourcesContent":["//@flow\n\nimport type { EventEmitterType, EventID, Listener } from 'eventemitter2'\nimport arrify from '../util/arrify'\n\nconst normalizeScope = (scope: EventID) => arrify(scope)\n\nconst reduceStarter: string[] = []\n\nconst combineScope = (...scopes: EventID[]) => scopes.reduce(\n  (acc, val) => acc.concat(normalizeScope(val)),\n  reduceStarter\n)\n\nclass ScopedEmitter implements EventEmitterType {\n  scope: string[]\n  root: EventEmitterType\n  constructor(scope: EventID, parent: EventEmitterType) {\n    if (parent instanceof ScopedEmitter) {\n      this.root = parent.root\n      this.scope = combineScope(parent.scope, scope)\n    } else {\n      this.scope = normalizeScope(scope)\n      this.root = parent\n    }\n  }\n\n  on = (event: EventID, listener: Listener) => {\n    const fullEvent = this.scope.concat(normalizeScope(event))\n    // console.log('on', 'event', event, 'fullEvent', fullEvent, 'scope', this.scope, normalizeScope(event))\n    return this.root.on(fullEvent, listener)\n  }\n  off = (event: string, listener: Listener) => {\n    const fullEvent = [...this.scope, event].join('.')\n    return this.root.off(fullEvent, listener)\n  }\n  emit = (event: EventID, ...values: any[]) => {\n    const fullEvent = this.scope.concat(normalizeScope(event))\n    // console.log('emit', 'event', event, 'fullEvent', fullEvent, 'scope', this.scope, normalizeScope(event))\n    return this.root.emit(fullEvent, ...values)\n  }\n  addEventListener = this.on\n  removeEventListener = this.off\n}\n\n\n// const Predicate = tagged('Predicate', ['f'])\n\n// Make a Predicate that runs `f` to get\n// from `b` to `a`, then uses the original\n// Predicate function!\n// contramap :: Predicate a ~> (b -> a)\n//                          -> Predicate b\n// Predicate.prototype.contramap =\n//   function(f) {\n//     return Predicate(\n//       x => this.f(f(x))\n//     )\n//   }\n\n\n\ninterface ScopeType {\n  value: string[],\n  // static of(val: string[]): ScopeType,\n  map(fn: (val: string[]) => string[]): ScopeType,\n  concat(e: ScopeType): ScopeType,\n  ap(root: EventEmitterType): Emitter,\n  equals(val: ScopeType): boolean\n}\n\n\n\n\ntype Emitter = <V>(val: V) => boolean\n\nexport class EventScope/*ᐸElementTᐳ*/ {\n  value: string[]\n  joined: string\n  static of(val: string[] | string) {\n    let list\n    if (Array.isArray(val))\n      list = val\n    else\n      list = [val]\n    return new EventScope(list)\n  }\n  map(fn: (val: string[]) => string[]) {\n    return EventScope.of(fn(this.value))\n  }\n  concat(e: ScopeType) {\n    return EventScope.of([...this.value, ...e.value])\n  }\n  ap<T>(fn: (list: string[]) => T): T {\n    return fn(this.value)\n  }\n  equals(scope: EventScope) {\n    for (const [index, str] of this.value.entries())\n      if (str !== scope.value[index])\n        return false\n    return true\n  }\n  static empty() {\n    return EventScope.of([])\n  }\n  constructor(val: string[]) {\n    this.value = val\n    this.joined = val.join('.')\n  }\n}\n\nexport const emitScope =\n  (es: EventScope) =>\n    (em: EventEmitterType) =>\n      <-T>(data: T) => em.emit(es.value, data)\n\n// export const fromScope =\n//   (es: EventScope) =>\n//     (em: EventEmitterType) =>\n//       fromEvents(em, es.joined)\n\n// const ex = EventScope.of(['uid', 'scope'])\n\n// const mp = (val: string[]) => [val[0], 'a']\n// const ex1 = ex.map(mp)\nexport default ScopedEmitter\n"]}